<!DOCTYPE html>
<meta charset="utf-8">
<head>
    <title>Demolition Permits Time Series</title>
    <link rel="stylesheet" href="style2.css" type="text/css" media="screen" />
	<script src="static/chroniton.js"></script>
	<link href="static/chroniton.css" rel="stylesheet">
	<style>
		h1 {
			font-size: 24px;
		}

	</style>
</head>
<div id="stats">
<h1>
	<font color="#8d9093">
	Demolition Permits<br/>
	Year: </font><font color="#2E648C"><span id="year">2000</span></font>
</h1><br/><br/>
<h2>
	<font color="#8d9093">
	Citywide Total: </font><font color="#2E648C"><span id="total">1,562</span></font><br/>
	<i><font color="#2E648C">
	<span id="pctChg">+15.96% </span></font><font size=2px color="#8d9093"> from previous year</font></i><br/><br/>
	<font color="#8d9093">
	Citywide Average: </font><font color="#2E648C"><span id="avg">27.4</span></font><br/><br/>
	<font color="#8d9093">
	Community District with<br/>Highest Permit Count: </font><font color="#2E648C"><span id="most">503</span></font>
</h2>
</div>
<!-- <h2> -->
	<!-- <font size="18px">Year: <span id="year">2000</span></font> -->
<!-- </h2> -->
<div id="chart"></div>
<div id="slider">
</div>  
<div id="main-wrapper">
    
</div><!-- @end #main-wrapper -->

<div id="tooltip" class="tooltip">
    <h3 class="name"></h3>
	    <div data-metric="count" class="line">
		Demolition Permits (<span id="year"></span>): <div class="count_val val"></div>
    </div>
</div>

<script src="https://d3js.org/d3.v3.min.js"></script>
<script src="https://d3js.org/queue.v1.min.js"></script>
<script src="https://d3js.org/topojson.v1.min.js"></script>




<script>


var width = 960,
    height = 600,
    center = [width / 2, height / 2],
    defaultFill = "#E1E1E1";

//var color_domain = [23,621,1109,1762,3135,5613]
var color_domain = [6,15,26,42,64,100]
var ext_color_domain = [0,6,15,26,42,64,100]
var legend_labels = ["0 - 5", "6 - 14", "15 - 25", "26 - 41", "42 - 63", "64 - 99", "100 - 305"]
var color = d3.scale.threshold()
	.domain(color_domain)
	.range(["#D3E5E8", "#B6CED9", "#97B4C7", "#7D9FB8", "#628AA8", "#49769C", "#2E648C"]);

var projection = d3.geo.mercator()
    .scale(61000)
	.center( [-73.85,40.71] )
    .translate([width / 2, height / 2]);

var path = d3.geo.path()
    .projection(projection);
	
var svg = d3.select("body #main-wrapper").append("svg")
    .attr("width", width)
    .attr("height", height);

var g = svg.append("g");

var tooltip = d3.select("#tooltip")
	.attr("class", "tooltip")
	.style("opacity", 0);
 
var CURR_SELECT = ["count"];

var startYear = 2000;
var endYear = 2016;
var currentYear = startYear;
var countById = d3.map();

//onload = updateData();
onload = update2000();

/*
// Load data
queue()
    .defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2000_2016.csv")
	.await(ready_2000);
	//d3.select("h2 span").text("2000")
			//.transition()
			//.delay(750);

// After loading the data...
function ready_2000(error, CD_topoJSON, DM_2000_2016) {

	var commDist = CD_topoJSON.objects.geometries;
	for (var i in commDist) { //for each collection object
		for (var j in DM_2000_2016) { //for each row in the CSV
			if (commDist[i].properties.id == DM_2000_2016[j].FIPS) { //if they match
				for (var k in DM_2000_2016[i]) { //for each column in the a row within the CSV
					if (k != 'name' && k != 'FIPS') { // let's not add the name or id as props since we already have them
						if (attributeArray.indexOf(k) == -1) {
							attributeArray.push(k); //add new column headings to our array for later
						}
						commDist[i].properties[k] = Number(DM_2000_2016[j][k]) //add each CSV column key/value to geometry
					}
				}
				break; //stop looking through the CSV since we made our match
			}
		}
	}
	drawMap(CD_topoJSON);
}
function drawMap(CD_topoJSON) {
   g.append("g")
        .attr("class", "collection")
        .selectAll("path")
          .data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
        .enter().append("path")
		
          .attr("d", path)
		  .style("fill", function(d) {return color(countById[d.id]); })	
}*/

function currentData() {
	switch(currentYear.toString()) {
		case '2000':
			update2000();
			break;
		case '2001':
			update2001();
			break;
		case '2002':
			update2002();
			break;
		case '2003':
			update2003();
			break;
		case '2004':
			update2004();
			break;
		case '2005':
			update2005();
			break;
		case '2006':
			update2006();
			break;
		case '2007':
			update2007();
			break;
		case '2008':
			update2008();
			break;
		case '2009':
			update2009();
			break;
		case '2010':
			update2010();
			break;
		case '2011':
			update2011();
			break;
		case '2012':
			update2012();
			break;
		case '2013':
			update2013();
			break;
		case '2014':
			update2014();
			break;
		case '2015':
			update2015();
			break;
		case '2016':
			update2016();
			break;
	}
}

// Load data
function update2000() {
queue()
    .defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2000.csv", typeAndSet)
	.await(ready_2000);
	d3.select("#year").html(currentYear);
	d3.select("#total").html(1562);
	d3.select("#avg").html(27.4);
	d3.select("#most").html(503);
	d3.select("#pctChg").html("+15.96%");
		<!-- .transition() -->
		<!-- .duration(500); -->
}
function ready_2000(error, CD_topoJSON, DM_2000) {
	//var countById= {};
	//var countById = d3.map();
	DM_2000.forEach(function(d) {countById[d.FIPS] = +d.count;});
	
	
	g.append("g")
		.attr("class", "collection")
		.selectAll("path")
		.data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
		.enter().append("path")
		.attr("d", path)
		
		.on("mouseover", function(d) {
		d3.select(this.parentNode.appendChild(this)).classed("selected", true);
		tooltip.transition().duration(100)
		.style("opacity", 1)
		if (d3.event.pageX > (width - 200)) {
		tooltip.style("left", (d3.event.pageX - 210) + "px");
		} else {
		tooltip.style("left", (d3.event.pageX + 20) + "px")
			.style("top", (d3.event.pageY -30) + "px");
		}
		if (d3.event.pageY > (height - 150)) {
		tooltip.style("top", (d3.event.pageY -140) + "px");
		} else {
		tooltip.style("top", (d3.event.pageY -30) + "px");
		}
		tooltip.select(".name").text(countById.get(d.id)['name']);
		tooltip.select(".count_val.val").text(countById.get(d.id)["count"])
		tooltip.select("#year").text(currentYear)
		})
		.on("mouseout", function() {
		d3.select(this).classed("selected", false);
		tooltip.transition().duration(300)
		.style("opacity", 0);
		})
		
		//.transition().duration(500)
		updateClasses();
	
}
function update2001() {
queue()
    .defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2001.csv", typeAndSet)
	.await(ready_2001);
	d3.select("#year").html(currentYear);
	d3.select("#total").html(1592);
	d3.select("#avg").html(26.5);
	d3.select("#most").html(503);
	d3.select("#pctChg").html("+1.92%");
		<!-- .transition() -->
		<!-- .duration(500); -->
}
function ready_2001(error, CD_topoJSON, DM_2001) {
	//var countById= {};
	DM_2001.forEach(function(d) {countById[d.FIPS] = +d.count;});
	
	g.append("g")
		.attr("class", "collection")
		.selectAll("path")
		.data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
		.enter().append("path")
		.attr("d", path)
		
		.on("mouseover", function(d) {
		d3.select(this.parentNode.appendChild(this)).classed("selected", true);
		tooltip.transition().duration(100)
		.style("opacity", 1)
		if (d3.event.pageX > (width - 200)) {
		tooltip.style("left", (d3.event.pageX - 210) + "px");
		} else {
		tooltip.style("left", (d3.event.pageX + 20) + "px")
			.style("top", (d3.event.pageY -30) + "px");
		}
		if (d3.event.pageY > (height - 150)) {
		tooltip.style("top", (d3.event.pageY -140) + "px");
		} else {
		tooltip.style("top", (d3.event.pageY -30) + "px");
		}
		tooltip.select(".name").text(countById.get(d.id)['name']);
		tooltip.select(".count_val.val").text(countById.get(d.id)["count"])
		tooltip.select("#year").text(currentYear)
		})
		.on("mouseout", function() {
		d3.select(this).classed("selected", false);
		tooltip.transition().duration(300)
		.style("opacity", 0);
		})
		
		//.style("fill", function(d) {return color(countById[d.id]); })
		//.transition().duration(500)
		updateClasses();

}
function update2002() {
queue()
    .defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2002.csv", typeAndSet)
	.await(ready_2002);
	d3.select("#year").html(currentYear);
	d3.select("#total").html(2023);
	d3.select("#avg").html(33.7);
	d3.select("#most").html(502);
	d3.select("#pctChg").html("+27.07%");
		<!-- .transition() -->
		<!-- .duration(500); -->
}
function ready_2002(error, CD_topoJSON, DM_2002) {
	//var countById= {};
	DM_2002.forEach(function(d) {countById[d.FIPS] = +d.count;});
	
	g.append("g")
		.attr("class", "collection")
		.selectAll("path")
		.data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
		.enter().append("path")
		.attr("d", path)
		
		.on("mouseover", function(d) {
		d3.select(this.parentNode.appendChild(this)).classed("selected", true);
		tooltip.transition().duration(100)
		.style("opacity", 1)
		if (d3.event.pageX > (width - 200)) {
		tooltip.style("left", (d3.event.pageX - 210) + "px");
		} else {
		tooltip.style("left", (d3.event.pageX + 20) + "px")
			.style("top", (d3.event.pageY -30) + "px");
		}
		if (d3.event.pageY > (height - 150)) {
		tooltip.style("top", (d3.event.pageY -140) + "px");
		} else {
		tooltip.style("top", (d3.event.pageY -30) + "px");
		}
		tooltip.select(".name").text(countById.get(d.id)['name']);
		tooltip.select(".count_val.val").text(countById.get(d.id)["count"])
		tooltip.select("#year").text(currentYear)
		})
		.on("mouseout", function() {
		d3.select(this).classed("selected", false);
		tooltip.transition().duration(300)
		.style("opacity", 0);
		})
		
		//.style("fill", function(d) {return color(countById[d.id]); })
		//.transition().duration(500)
		updateClasses();
}
function update2003() {
queue()
    .defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2003.csv", typeAndSet)
	.await(ready_2003);
	d3.select("#year").html(currentYear);
	d3.select("#total").html(2390);
	d3.select("#avg").html(40.5);
	d3.select("#most").html(407);
	d3.select("#pctChg").html("+18.14%");
		<!-- .transition() -->
		<!-- .duration(500); -->
}
function ready_2003(error, CD_topoJSON, DM_2003) {
	//var countById= {};
	DM_2003.forEach(function(d) {countById[d.FIPS] = +d.count;});
	
	g.append("g")
		.attr("class", "collection")
		.selectAll("path")
		.data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
		.enter().append("path")
		.attr("d", path)
		
		.on("mouseover", function(d) {
		d3.select(this.parentNode.appendChild(this)).classed("selected", true);
		tooltip.transition().duration(100)
		.style("opacity", 1)
		if (d3.event.pageX > (width - 200)) {
		tooltip.style("left", (d3.event.pageX - 210) + "px");
		} else {
		tooltip.style("left", (d3.event.pageX + 20) + "px")
			.style("top", (d3.event.pageY -30) + "px");
		}
		if (d3.event.pageY > (height - 150)) {
		tooltip.style("top", (d3.event.pageY -140) + "px");
		} else {
		tooltip.style("top", (d3.event.pageY -30) + "px");
		}
		tooltip.select(".name").text(countById.get(d.id)['name']);
		tooltip.select(".count_val.val").text(countById.get(d.id)["count"])
		tooltip.select("#year").text(currentYear)
		})
		.on("mouseout", function() {
		d3.select(this).classed("selected", false);
		tooltip.transition().duration(300)
		.style("opacity", 0);
		})
		
		//.style("fill", function(d) {return color(countById[d.id]); })
		//.transition().duration(500)
		updateClasses();
}
function update2004() {
queue()
    .defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2004.csv", typeAndSet)
	.await(ready_2004);
	d3.select("#year").html(currentYear);
	d3.select("#total").html(3025);
	d3.select("#avg").html(51.3);
	d3.select("#most").html(407);
	d3.select("#pctChg").html("+26.57%");
		<!-- .transition() -->
		<!-- .duration(500); -->
}
function ready_2004(error, CD_topoJSON, DM_2004) {
	//var countById= {};
	DM_2004.forEach(function(d) {countById[d.FIPS] = +d.count;});
	
	g.append("g")
		.attr("class", "collection")
		.selectAll("path")
		.data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
		.enter().append("path")
		.attr("d", path)
		
		.on("mouseover", function(d) {
		d3.select(this.parentNode.appendChild(this)).classed("selected", true);
		tooltip.transition().duration(100)
		.style("opacity", 1)
		if (d3.event.pageX > (width - 200)) {
		tooltip.style("left", (d3.event.pageX - 210) + "px");
		} else {
		tooltip.style("left", (d3.event.pageX + 20) + "px")
			.style("top", (d3.event.pageY -30) + "px");
		}
		if (d3.event.pageY > (height - 150)) {
		tooltip.style("top", (d3.event.pageY -140) + "px");
		} else {
		tooltip.style("top", (d3.event.pageY -30) + "px");
		}
		tooltip.select(".name").text(countById.get(d.id)['name']);
		tooltip.select(".count_val.val").text(countById.get(d.id)["count"])
		tooltip.select("#year").text(currentYear)
		})
		.on("mouseout", function() {
		d3.select(this).classed("selected", false);
		tooltip.transition().duration(300)
		.style("opacity", 0);
		})
		
		//.style("fill", function(d) {return color(countById[d.id]); })
		//.transition().duration(500)
		updateClasses();
}
function update2005() {
queue()
    .defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2005.csv", typeAndSet)
	.await(ready_2005);
	d3.select("#year").html(currentYear);
	d3.select("#total").html(3687);
	d3.select("#avg").html(60.4);
	d3.select("#most").html(407);
	d3.select("#pctChg").html("+21.88%");
		<!-- .transition() -->
		<!-- .duration(500); -->
}
function ready_2005(error, CD_topoJSON, DM_2005) {
	//var countById= {};
	DM_2005.forEach(function(d) {countById[d.FIPS] = +d.count;});
	
	g.append("g")
		.attr("class", "collection")
		.selectAll("path")
		.data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
		.enter().append("path")
		.attr("d", path)
		
		.on("mouseover", function(d) {
		d3.select(this.parentNode.appendChild(this)).classed("selected", true);
		tooltip.transition().duration(100)
		.style("opacity", 1)
		if (d3.event.pageX > (width - 200)) {
		tooltip.style("left", (d3.event.pageX - 210) + "px");
		} else {
		tooltip.style("left", (d3.event.pageX + 20) + "px")
			.style("top", (d3.event.pageY -30) + "px");
		}
		if (d3.event.pageY > (height - 150)) {
		tooltip.style("top", (d3.event.pageY -140) + "px");
		} else {
		tooltip.style("top", (d3.event.pageY -30) + "px");
		}
		tooltip.select(".name").text(countById.get(d.id)['name']);
		tooltip.select(".count_val.val").text(countById.get(d.id)["count"])
		tooltip.select("#year").text(currentYear)
		})
		.on("mouseout", function() {
		d3.select(this).classed("selected", false);
		tooltip.transition().duration(300)
		.style("opacity", 0);
		})
		
		//.style("fill", function(d) {return color(countById[d.id]); })
		//.transition().duration(500)
		updateClasses();
}
function update2006() {
queue()
    .defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2006.csv", typeAndSet)
	.await(ready_2006);
	d3.select("#year").html(currentYear);
	d3.select("#total").html(3901);
	d3.select("#avg").html(66.1);
	d3.select("#most").html(407);
	d3.select("#pctChg").html("+5.80%");
		<!-- .transition() -->
		<!-- .duration(500); -->
}
function ready_2006(error, CD_topoJSON, DM_2006) {
	//var countById= {};
	DM_2006.forEach(function(d) {countById[d.FIPS] = +d.count;});
	
	g.append("g")
		.attr("class", "collection")
		.selectAll("path")
		.data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
		.enter().append("path")
		.attr("d", path)
		
		.on("mouseover", function(d) {
		d3.select(this.parentNode.appendChild(this)).classed("selected", true);
		tooltip.transition().duration(100)
		.style("opacity", 1)
		if (d3.event.pageX > (width - 200)) {
		tooltip.style("left", (d3.event.pageX - 210) + "px");
		} else {
		tooltip.style("left", (d3.event.pageX + 20) + "px")
			.style("top", (d3.event.pageY -30) + "px");
		}
		if (d3.event.pageY > (height - 150)) {
		tooltip.style("top", (d3.event.pageY -140) + "px");
		} else {
		tooltip.style("top", (d3.event.pageY -30) + "px");
		}
		tooltip.select(".name").text(countById.get(d.id)['name']);
		tooltip.select(".count_val.val").text(countById.get(d.id)["count"])
		tooltip.select("#year").text(currentYear)
		})
		.on("mouseout", function() {
		d3.select(this).classed("selected", false);
		tooltip.transition().duration(300)
		.style("opacity", 0);
		})
		
		//.style("fill", function(d) {return color(countById[d.id]); })
		//.transition().duration(500)
		updateClasses();
}
function update2007() {
queue()
    .defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2007.csv", typeAndSet)
	.await(ready_2007);
	d3.select("#year").html(currentYear);
	d3.select("#total").html(3505);
	d3.select("#avg").html(59.4);
	d3.select("#most").html(301);
	d3.select("#pctChg").html("-10.15%");
		<!-- .transition() -->
		<!-- .duration(500); -->
}
function ready_2007(error, CD_topoJSON, DM_2007) {
	//var countById= {};
	DM_2007.forEach(function(d) {countById[d.FIPS] = +d.count;});
	
	g.append("g")
		.attr("class", "collection")
		.selectAll("path")
		.data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
		.enter().append("path")
		.attr("d", path)
		
		.on("mouseover", function(d) {
		d3.select(this.parentNode.appendChild(this)).classed("selected", true);
		tooltip.transition().duration(100)
		.style("opacity", 1)
		if (d3.event.pageX > (width - 200)) {
		tooltip.style("left", (d3.event.pageX - 210) + "px");
		} else {
		tooltip.style("left", (d3.event.pageX + 20) + "px")
			.style("top", (d3.event.pageY -30) + "px");
		}
		if (d3.event.pageY > (height - 150)) {
		tooltip.style("top", (d3.event.pageY -140) + "px");
		} else {
		tooltip.style("top", (d3.event.pageY -30) + "px");
		}
		tooltip.select(".name").text(countById.get(d.id)['name']);
		tooltip.select(".count_val.val").text(countById.get(d.id)["count"])
		tooltip.select("#year").text(currentYear)
		})
		.on("mouseout", function() {
		d3.select(this).classed("selected", false);
		tooltip.transition().duration(300)
		.style("opacity", 0);
		})
		
		//.style("fill", function(d) {return color(countById[d.id]); })
		//.transition().duration(500)
		updateClasses();
}
function update2008() {
queue()
    .defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2008.csv", typeAndSet)
	.await(ready_2008);
	d3.select("#year").html(currentYear);
	d3.select("#total").html(2653);
	d3.select("#avg").html(44.2);
	d3.select("#most").html(407);
	d3.select("#pctChg").html("-24.31%");
		<!-- .transition() -->
		<!-- .duration(500); -->
}
function ready_2008(error, CD_topoJSON, DM_2008) {
	//var countById= {};
	DM_2008.forEach(function(d) {countById[d.FIPS] = +d.count;});
	
	g.append("g")
		.attr("class", "collection")
		.selectAll("path")
		.data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
		.enter().append("path")
		.attr("d", path)
		
		.on("mouseover", function(d) {
		d3.select(this.parentNode.appendChild(this)).classed("selected", true);
		tooltip.transition().duration(100)
		.style("opacity", 1)
		if (d3.event.pageX > (width - 200)) {
		tooltip.style("left", (d3.event.pageX - 210) + "px");
		} else {
		tooltip.style("left", (d3.event.pageX + 20) + "px")
			.style("top", (d3.event.pageY -30) + "px");
		}
		if (d3.event.pageY > (height - 150)) {
		tooltip.style("top", (d3.event.pageY -140) + "px");
		} else {
		tooltip.style("top", (d3.event.pageY -30) + "px");
		}
		tooltip.select(".name").text(countById.get(d.id)['name']);
		tooltip.select(".count_val.val").text(countById.get(d.id)["count"])
		tooltip.select("#year").text(currentYear)
		})
		.on("mouseout", function() {
		d3.select(this).classed("selected", false);
		tooltip.transition().duration(300)
		.style("opacity", 0);
		})
		
		//.style("fill", function(d) {return color(countById[d.id]); })
		//.transition().duration(500)
		updateClasses();
}
function update2009() {
queue()
    .defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2009.csv", typeAndSet)
	.await(ready_2009);
	d3.select("#year").html(currentYear);
	d3.select("#total").html(1422);
	d3.select("#avg").html(24.5);
	d3.select("#most").html(407);
	d3.select("#pctChg").html("-46.40%");
		<!-- .transition() -->
		<!-- .duration(500); -->
}
function ready_2009(error, CD_topoJSON, DM_2009) {
	//var countById= {};
	DM_2009.forEach(function(d) {countById[d.FIPS] = +d.count;});
	
	g.append("g")
		.attr("class", "collection")
		.selectAll("path")
		.data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
		.enter().append("path")
		.attr("d", path)
		
		.on("mouseover", function(d) {
		d3.select(this.parentNode.appendChild(this)).classed("selected", true);
		tooltip.transition().duration(100)
		.style("opacity", 1)
		if (d3.event.pageX > (width - 200)) {
		tooltip.style("left", (d3.event.pageX - 210) + "px");
		} else {
		tooltip.style("left", (d3.event.pageX + 20) + "px")
			.style("top", (d3.event.pageY -30) + "px");
		}
		if (d3.event.pageY > (height - 150)) {
		tooltip.style("top", (d3.event.pageY -140) + "px");
		} else {
		tooltip.style("top", (d3.event.pageY -30) + "px");
		}
		tooltip.select(".name").text(countById.get(d.id)['name']);
		tooltip.select(".count_val.val").text(countById.get(d.id)["count"])
		tooltip.select("#year").text(currentYear)
		})
		.on("mouseout", function() {
		d3.select(this).classed("selected", false);
		tooltip.transition().duration(300)
		.style("opacity", 0);
		})
		
		//.style("fill", function(d) {return color(countById[d.id]); })
		//.transition().duration(500)
		updateClasses();
}
function update2010() {
queue()
    .defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2010.csv", typeAndSet)
	.await(ready_2010);
	d3.select("#year").html(currentYear);
	d3.select("#total").html(1094);
	d3.select("#avg").html(18.4);
	d3.select("#most").html(407);
	d3.select("#pctChg").html("-23.07%");
		<!-- .transition() -->
		<!-- .duration(500); -->
}
function ready_2010(error, CD_topoJSON, DM_2010) {
	//var countById= {};
	DM_2010.forEach(function(d) {countById[d.FIPS] = +d.count;});
	
	g.append("g")
		.attr("class", "collection")
		.selectAll("path")
		.data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
		.enter().append("path")
		.attr("d", path)
		
		.on("mouseover", function(d) {
		d3.select(this.parentNode.appendChild(this)).classed("selected", true);
		tooltip.transition().duration(100)
		.style("opacity", 1)
		if (d3.event.pageX > (width - 200)) {
		tooltip.style("left", (d3.event.pageX - 210) + "px");
		} else {
		tooltip.style("left", (d3.event.pageX + 20) + "px")
			.style("top", (d3.event.pageY -30) + "px");
		}
		if (d3.event.pageY > (height - 150)) {
		tooltip.style("top", (d3.event.pageY -140) + "px");
		} else {
		tooltip.style("top", (d3.event.pageY -30) + "px");
		}
		tooltip.select(".name").text(countById.get(d.id)['name']);
		tooltip.select(".count_val.val").text(countById.get(d.id)["count"])
		tooltip.select("#year").text(currentYear)
		})
		.on("mouseout", function() {
		d3.select(this).classed("selected", false);
		tooltip.transition().duration(300)
		.style("opacity", 0);
		})
		
		//.style("fill", function(d) {return color(countById[d.id]); })
		//.transition().duration(500)
		updateClasses();
}
function update2011() {
queue()
    .defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2011.csv", typeAndSet)
	.await(ready_2011);
	d3.select("#year").html(currentYear);
	d3.select("#total").html(1177);
	d3.select("#avg").html(19.9);
	d3.select("#most").html(407);
	d3.select("#pctChg").html("+7.59%");
		<!-- .transition() -->
		<!-- .duration(500); -->
}
function ready_2011(error, CD_topoJSON, DM_2011) {
	//var countById= {};
	DM_2011.forEach(function(d) {countById[d.FIPS] = +d.count;});
	
	g.append("g")
		.attr("class", "collection")
		.selectAll("path")
		.data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
		.enter().append("path")
		.attr("d", path)
		
		.on("mouseover", function(d) {
		d3.select(this.parentNode.appendChild(this)).classed("selected", true);
		tooltip.transition().duration(100)
		.style("opacity", 1)
		if (d3.event.pageX > (width - 200)) {
		tooltip.style("left", (d3.event.pageX - 210) + "px");
		} else {
		tooltip.style("left", (d3.event.pageX + 20) + "px")
			.style("top", (d3.event.pageY -30) + "px");
		}
		if (d3.event.pageY > (height - 150)) {
		tooltip.style("top", (d3.event.pageY -140) + "px");
		} else {
		tooltip.style("top", (d3.event.pageY -30) + "px");
		}
		tooltip.select(".name").text(countById.get(d.id)['name']);
		tooltip.select(".count_val.val").text(countById.get(d.id)["count"])
		tooltip.select("#year").text(currentYear)
		})
		.on("mouseout", function() {
		d3.select(this).classed("selected", false);
		tooltip.transition().duration(300)
		.style("opacity", 0);
		})
		
		//.style("fill", function(d) {return color(countById[d.id]); })
		//.transition().duration(500)
		updateClasses();
}
function update2012() {
queue()
    .defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2012.csv", typeAndSet)
	.await(ready_2012);
	d3.select("#year").html(currentYear);
	d3.select("#total").html(1267);
	d3.select("#avg").html(20.8);
	d3.select("#most").html(407);
	d3.select("#pctChg").html("+7.65%");
		<!-- .transition() -->
		<!-- .duration(500); -->
}
function ready_2012(error, CD_topoJSON, DM_2012) {
	//var countById= {};
	DM_2012.forEach(function(d) {countById[d.FIPS] = +d.count;});
	
	g.append("g")
		.attr("class", "collection")
		.selectAll("path")
		.data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
		.enter().append("path")
		.attr("d", path)
		
		.on("mouseover", function(d) {
		d3.select(this.parentNode.appendChild(this)).classed("selected", true);
		tooltip.transition().duration(100)
		.style("opacity", 1)
		if (d3.event.pageX > (width - 200)) {
		tooltip.style("left", (d3.event.pageX - 210) + "px");
		} else {
		tooltip.style("left", (d3.event.pageX + 20) + "px")
			.style("top", (d3.event.pageY -30) + "px");
		}
		if (d3.event.pageY > (height - 150)) {
		tooltip.style("top", (d3.event.pageY -140) + "px");
		} else {
		tooltip.style("top", (d3.event.pageY -30) + "px");
		}
		tooltip.select(".name").text(countById.get(d.id)['name']);
		tooltip.select(".count_val.val").text(countById.get(d.id)["count"])
		tooltip.select("#year").text(currentYear)
		})
		.on("mouseout", function() {
		d3.select(this).classed("selected", false);
		tooltip.transition().duration(300)
		.style("opacity", 0);
		})
		
		//.style("fill", function(d) {return color(countById[d.id]); })
		//.transition().duration(500)
		updateClasses();
}
function update2013() {
queue()
    .defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2013.csv", typeAndSet)
	.await(ready_2013);
	d3.select("#year").html(currentYear);
	d3.select("#total").html(1575);
	d3.select("#avg").html(26.7);
	d3.select("#most").html(502);
	d3.select("#pctChg").html("+24.31%");
		<!-- .transition() -->
		<!-- .duration(500); -->
}
function ready_2013(error, CD_topoJSON, DM_2013) {
	//var countById= {};
	DM_2013.forEach(function(d) {countById[d.FIPS] = +d.count;});
	
	g.append("g")
		.attr("class", "collection")
		.selectAll("path")
		.data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
		.enter().append("path")
		.attr("d", path)
		
		.on("mouseover", function(d) {
		d3.select(this.parentNode.appendChild(this)).classed("selected", true);
		tooltip.transition().duration(100)
		.style("opacity", 1)
		if (d3.event.pageX > (width - 200)) {
		tooltip.style("left", (d3.event.pageX - 210) + "px");
		} else {
		tooltip.style("left", (d3.event.pageX + 20) + "px")
			.style("top", (d3.event.pageY -30) + "px");
		}
		if (d3.event.pageY > (height - 150)) {
		tooltip.style("top", (d3.event.pageY -140) + "px");
		} else {
		tooltip.style("top", (d3.event.pageY -30) + "px");
		}
		tooltip.select(".name").text(countById.get(d.id)['name']);
		tooltip.select(".count_val.val").text(countById.get(d.id)["count"])
		tooltip.select("#year").text(currentYear)
		})
		.on("mouseout", function() {
		d3.select(this).classed("selected", false);
		tooltip.transition().duration(300)
		.style("opacity", 0);
		})
		
		//.style("fill", function(d) {return color(countById[d.id]); })
		//.transition().duration(500)
		updateClasses();
}
function update2014() {
queue()
    .defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2014.csv", typeAndSet)
	.await(ready_2014);
	d3.select("#year").html(currentYear);
	d3.select("#total").html(1869);
	d3.select("#avg").html(31.2);
	d3.select("#most").html(503);
	d3.select("#pctChg").html("+18.66%");
		<!-- .transition() -->
		<!-- .duration(500); -->
}
function ready_2014(error, CD_topoJSON, DM_2014) {
	//var countById= {};
	DM_2014.forEach(function(d) {countById[d.FIPS] = +d.count;});
	
	g.append("g")
		.attr("class", "collection")
		.selectAll("path")
		.data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
		.enter().append("path")
		.attr("d", path)
		
		.on("mouseover", function(d) {
		d3.select(this.parentNode.appendChild(this)).classed("selected", true);
		tooltip.transition().duration(100)
		.style("opacity", 1)
		if (d3.event.pageX > (width - 200)) {
		tooltip.style("left", (d3.event.pageX - 210) + "px");
		} else {
		tooltip.style("left", (d3.event.pageX + 20) + "px")
			.style("top", (d3.event.pageY -30) + "px");
		}
		if (d3.event.pageY > (height - 150)) {
		tooltip.style("top", (d3.event.pageY -140) + "px");
		} else {
		tooltip.style("top", (d3.event.pageY -30) + "px");
		}
		tooltip.select(".name").text(countById.get(d.id)['name']);
		tooltip.select(".count_val.val").text(countById.get(d.id)["count"])
		tooltip.select("#year").text(currentYear)
		})
		.on("mouseout", function() {
		d3.select(this).classed("selected", false);
		tooltip.transition().duration(300)
		.style("opacity", 0);
		})
		
		//.style("fill", function(d) {return color(countById[d.id]); })
		//.transition().duration(500)
		updateClasses();
}
function update2015() {
queue()
    .defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2015.csv", typeAndSet)
	.await(ready_2015);
	d3.select("#year").html(currentYear);
	d3.select("#total").html(2188);
	d3.select("#avg").html(36.5);
	d3.select("#most").html(407);
	d3.select("#pctChg").html("+17.07%");
		<!-- .transition() -->
		<!-- .duration(500); -->
}
function ready_2015(error, CD_topoJSON, DM_2015) {
	//var countById= {};
	DM_2015.forEach(function(d) {countById[d.FIPS] = +d.count;});
	
	g.append("g")
		.attr("class", "collection")
		.selectAll("path")
		.data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
		.enter().append("path")
		.attr("d", path)
		
		.on("mouseover", function(d) {
		d3.select(this.parentNode.appendChild(this)).classed("selected", true);
		tooltip.transition().duration(100)
		.style("opacity", 1)
		if (d3.event.pageX > (width - 200)) {
		tooltip.style("left", (d3.event.pageX - 210) + "px");
		} else {
		tooltip.style("left", (d3.event.pageX + 20) + "px")
			.style("top", (d3.event.pageY -30) + "px");
		}
		if (d3.event.pageY > (height - 150)) {
		tooltip.style("top", (d3.event.pageY -140) + "px");
		} else {
		tooltip.style("top", (d3.event.pageY -30) + "px");
		}
		tooltip.select(".name").text(countById.get(d.id)['name']);
		tooltip.select(".count_val.val").text(countById.get(d.id)["count"])
		tooltip.select("#year").text(currentYear)
		})
		.on("mouseout", function() {
		d3.select(this).classed("selected", false);
		tooltip.transition().duration(300)
		.style("opacity", 0);
		})
		
		//.style("fill", function(d) {return color(countById[d.id]); })
		//.transition().duration(500)
		updateClasses();
}
function update2016() {
queue()
    .defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2016.csv", typeAndSet)
	.await(ready_2016);
	d3.select("#year").html(currentYear);
	d3.select("#total").html(2252);
	d3.select("#avg").html(37.5);
	d3.select("#most").html(407);
	d3.select("#pctChg").html("+2.93%");
		<!-- .transition() -->
		<!-- .duration(500); -->
}
function ready_2016(error, CD_topoJSON, DM_2016) {
	//var countById= {};
	DM_2016.forEach(function(d) {countById[d.FIPS] = +d.count;});
	
	g.append("g")
		.attr("class", "collection")
		.selectAll("path")
		.data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
		.enter().append("path")
		.attr("d", path)
		
		.on("mouseover", function(d) {
		d3.select(this.parentNode.appendChild(this)).classed("selected", true);
		tooltip.transition().duration(100)
		.style("opacity", 1)
		if (d3.event.pageX > (width - 200)) {
		tooltip.style("left", (d3.event.pageX - 210) + "px");
		} else {
		tooltip.style("left", (d3.event.pageX + 20) + "px")
			.style("top", (d3.event.pageY -30) + "px");
		}
		if (d3.event.pageY > (height - 150)) {
		tooltip.style("top", (d3.event.pageY -140) + "px");
		} else {
		tooltip.style("top", (d3.event.pageY -30) + "px");
		}
		tooltip.select(".name").text(countById.get(d.id)['name']);
		tooltip.select(".count_val.val").text(countById.get(d.id)["count"])
		tooltip.select("#year").text(currentYear)
		})
		.on("mouseout", function() {
		d3.select(this).classed("selected", false);
		tooltip.transition().duration(300)
		.style("opacity", 0);
		})
		
		//.style("fill", function(d) {return color(countById[d.id]); })
		//.transition().duration(500)
		updateClasses();
}
/*
function updateData() {

queue()
    .defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2000.csv")
	.defer(d3.csv, "data/DM_2001.csv")
	.defer(d3.csv, "data/DM_2002.csv")
	.defer(d3.csv, "data/DM_2003.csv")
	.defer(d3.csv, "data/DM_2004.csv")
	.defer(d3.csv, "data/DM_2005.csv")
	.defer(d3.csv, "data/DM_2006.csv")
	.defer(d3.csv, "data/DM_2007.csv")
	.defer(d3.csv, "data/DM_2008.csv")
	.defer(d3.csv, "data/DM_2009.csv")
	.defer(d3.csv, "data/DM_2010.csv")
	.defer(d3.csv, "data/DM_2011.csv")
	.defer(d3.csv, "data/DM_2012.csv")
	.defer(d3.csv, "data/DM_2013.csv")
	.defer(d3.csv, "data/DM_2014.csv")
	.defer(d3.csv, "data/DM_2015.csv")
	.defer(d3.csv, "data/DM_2016.csv")
	.await(ready_2000);
	d3.select("#year").html(currentYear)
	//d3.select("h2 span").text("2000")
			.transition()
			.duration(750);
}	
// After loading the data...
function ready_2000(error, CD_topoJSON, DM_2000, DM_2001, DM_2002, DM_2003, DM_2004, DM_2005, DM_2006, DM_2007, DM_2008, DM_2009, DM_2010, DM_2011, DM_2012, DM_2013, DM_2014, DM_2015, DM_2016) {

	var countById = {};
	switch(currentYear.toString()) {
		case '2000':
			DM_2000.forEach (function(d) {countById[d.FIPS] = +d.count; });
			break;
		case '2001':
			DM_2001.forEach (function(d) {countById[d.FIPS] = +d.count; });
			break;
		case '2002':
			DM_2002.forEach (function(d) {countById[d.FIPS] = +d.count; });
			break;
		case '2003':
			DM_2003.forEach (function(d) {countById[d.FIPS] = +d.count; });
			break;
		case '2004':
			DM_2004.forEach (function(d) {countById[d.FIPS] = +d.count; });
			break;
		case '2005':
			DM_2005.forEach (function(d) {countById[d.FIPS] = +d.count; });
			break;
		case '2006':
			DM_2006.forEach (function(d) {countById[d.FIPS] = +d.count; });
			break;
		case '2007':
			DM_2007.forEach (function(d) {countById[d.FIPS] = +d.count; });
			break;
		case '2008':
			DM_2008.forEach (function(d) {countById[d.FIPS] = +d.count; });
			break;
		case '2009':
			DM_2009.forEach (function(d) {countById[d.FIPS] = +d.count; });
			break;
		case '2010':
			DM_2010.forEach (function(d) {countById[d.FIPS] = +d.count; });
			break;
		case '2011':
			DM_2011.forEach (function(d) {countById[d.FIPS] = +d.count; });
			break;
		case '2012':
			DM_2012.forEach (function(d) {countById[d.FIPS] = +d.count; });
			break;
		case '2013':
			DM_2013.forEach (function(d) {countById[d.FIPS] = +d.count; });
			break;
		case '2014':
			DM_2014.forEach (function(d) {countById[d.FIPS] = +d.count; });
			break;
		case '2015':
			DM_2015.forEach (function(d) {countById[d.FIPS] = +d.count; });
			break;
		case '2016':
			DM_2016.forEach (function(d) {countById[d.FIPS] = +d.count; });
			break;
	}

    g.append("g")
        .attr("class", "collection")
        .selectAll("path")
          .data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
        .enter().append("path")
		
          .attr("d", path)
		  .style("fill", function(d) {return color(countById[d.id]); })
          
		//updateData_2001();	
}*/


/*
// Load data
queue()
    .defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2000.csv")
	.await(ready_2000);
	d3.select("h2 span").text("2000")
			//.transition()
			//.delay(750);

// After loading the data...
function ready_2000(error, CD_topoJSON, DM_2000) {

	var countById = {};
	DM_2000.forEach (function(d) {countById[d.FIPS] = +d.count; });

    g.append("g")
        .attr("class", "collection")
        .selectAll("path")
          .data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
        .enter().append("path")
		
          .attr("d", path)
		  .style("fill", function(d) {return color(countById[d.id]); })
          
		updateData_2001();
		
}
function updateData_2001(){
queue()
	.defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2001.csv")
	.await(ready_2001);
	d3.select("h2 span").text("2001")
			.transition()
			//.delay(750);
			.duration(750);

}

function ready_2001(error, CD_topoJSON, DM_2001) {

	var countById = {};
	DM_2001.forEach (function(d) {countById[d.FIPS] = +d.count; });

    g.append("g")
        .attr("class", "collection")
        .selectAll("path")
          .data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
        .enter().append("path")
		
          .attr("d", path)
		  .style("fill", function(d) {return color(countById[d.id]); })
          
		updateData_2002();
		
}
function updateData_2002(){
queue()
	.defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2002.csv")
	.await(ready_2002);
	d3.select("h2 span").text("2002")
			.transition()
			//.delay(750);
			.duration(750);
}

function ready_2002(error, CD_topoJSON, DM_2002) {

	var countById = {};
	DM_2002.forEach (function(d) {countById[d.FIPS] = +d.count; });

    g.append("g")
        .attr("class", "collection")
        .selectAll("path")
          .data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
        .enter().append("path")
		
          .attr("d", path)
		  .style("fill", function(d) {return color(countById[d.id]); })
          
		updateData_2003();
		
}
function updateData_2003(){
queue()
	.defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2003.csv")
	.await(ready_2003);
	d3.select("h2 span").text("2003")
			.transition()
			//.delay(750);
			.duration(750);
}
function ready_2003(error, CD_topoJSON, DM_2003) {

	var countById = {};
	DM_2003.forEach (function(d) {countById[d.FIPS] = +d.count; });

    g.append("g")
        .attr("class", "collection")
        .selectAll("path")
          .data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
        .enter().append("path")
		
          .attr("d", path)
		  .style("fill", function(d) {return color(countById[d.id]); })

		updateData_2004();
		
}
function updateData_2004(){
queue()
	.defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2004.csv")
	.await(ready_2004);
	d3.select("h2 span").text("2004")
			.transition()
			//.delay(750);
			.duration(750);
}
function ready_2004(error, CD_topoJSON, DM_2004) {

	var countById = {};
	DM_2004.forEach (function(d) {countById[d.FIPS] = +d.count; });

    g.append("g")
        .attr("class", "collection")
        .selectAll("path")
          .data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
        .enter().append("path")		
		
          .attr("d", path)
		  .style("fill", function(d) {return color(countById[d.id]); })

		updateData_2005();
		
}
function updateData_2005(){
queue()
	.defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2005.csv")
	.await(ready_2005);
	d3.select("h2 span").text("2005")
			.transition()
			//.delay(750);
			.duration(750);
}
function ready_2005(error, CD_topoJSON, DM_2005) {

	var countById = {};
	DM_2005.forEach (function(d) {countById[d.FIPS] = +d.count; });

    g.append("g")
        .attr("class", "collection")
        .selectAll("path")
          .data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
        .enter().append("path")
		
          .attr("d", path)
		  .style("fill", function(d) {return color(countById[d.id]); })
          
		updateData_2006();
		
}
function updateData_2006(){
queue()
	.defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2006.csv")
	.await(ready_2006);
	d3.select("h2 span").text("2006")
			.transition()
			//.delay(750);
			.duration(750);
}
function ready_2006(error, CD_topoJSON, DM_2006) {

	var countById = {};
	DM_2006.forEach (function(d) {countById[d.FIPS] = +d.count; });

    g.append("g")
        .attr("class", "collection")
        .selectAll("path")
          .data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
        .enter().append("path")
			
          .attr("d", path)
		  .style("fill", function(d) {return color(countById[d.id]); })
          
		updateData_2007();
		
}
function updateData_2007(){
queue()
	.defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2007.csv")
	.await(ready_2007);
	d3.select("h2 span").text("2007")
			.transition()
			//.delay(750);
			.duration(750);
}
function ready_2006(error, CD_topoJSON, DM_2007) {

	var countById = {};
	DM_2007.forEach (function(d) {countById[d.FIPS] = +d.count; });

    g.append("g")
        .attr("class", "collection")
        .selectAll("path")
          .data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
        .enter().append("path")
		
          .attr("d", path)
		  .style("fill", function(d) {return color(countById[d.id]); })

		updateData_2008();
		
}
function updateData_2008(){
queue()
	.defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2008.csv")
	.await(ready_2008);
	d3.select("h2 span").text("2008")
			.transition()
			//.delay(750);
			.duration(750);
}
function ready_2008(error, CD_topoJSON, DM_2008) {

	var countById = {};
	DM_2008.forEach (function(d) {countById[d.FIPS] = +d.count; });

    g.append("g")
        .attr("class", "collection")
        .selectAll("path")
          .data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
        .enter().append("path")
		
          .attr("d", path)
		  .style("fill", function(d) {return color(countById[d.id]); })

		updateData_2009();
		
}
function updateData_2009(){
queue()
	.defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2009.csv")
	.await(ready_2009);
	d3.select("h2 span").text("2009")
			.transition()
			//.delay(750);
			.duration(750);
}
function ready_2009(error, CD_topoJSON, DM_2009) {

	var countById = {};
	DM_2009.forEach (function(d) {countById[d.FIPS] = +d.count; });

    g.append("g")
        .attr("class", "collection")
        .selectAll("path")
          .data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
        .enter().append("path")
		
          .attr("d", path)
		  .style("fill", function(d) {return color(countById[d.id]); })

		updateData_2010();
		
}
function updateData_2010(){
queue()
	.defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2010.csv")
	.await(ready_2010);
	d3.select("h2 span").text("2010")
			.transition()
			//.delay(750);
			.duration(750);
}
function ready_2010(error, CD_topoJSON, DM_2010) {

	var countById = {};
	DM_2010.forEach (function(d) {countById[d.FIPS] = +d.count; });

    g.append("g")
        .attr("class", "collection")
        .selectAll("path")
          .data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
        .enter().append("path")
		
          .attr("d", path)
		  .style("fill", function(d) {return color(countById[d.id]); })

		updateData_2011();
		
}
function updateData_2011(){
queue()
	.defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2011.csv")
	.await(ready_2011);
	d3.select("h2 span").text("2011")
			.transition()
			//.delay(750);
			.duration(750);
}
function ready_2011(error, CD_topoJSON, DM_2011) {

	var countById = {};
	DM_2011.forEach (function(d) {countById[d.FIPS] = +d.count; });

    g.append("g")
        .attr("class", "collection")
        .selectAll("path")
          .data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
        .enter().append("path")
		
          .attr("d", path)
		  .style("fill", function(d) {return color(countById[d.id]); })

		updateData_2012();
		
}
function updateData_2012(){
queue()
	.defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2012.csv")
	.await(ready_2012);
	d3.select("h2 span").text("2012")
			.transition()
			//.delay(750);
			.duration(750);
}
function ready_2012(error, CD_topoJSON, DM_2012) {

	var countById = {};
	DM_2012.forEach (function(d) {countById[d.FIPS] = +d.count; });

    g.append("g")
        .attr("class", "collection")
        .selectAll("path")
          .data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
        .enter().append("path")
		
          .attr("d", path)
		  .style("fill", function(d) {return color(countById[d.id]); })

		updateData_2013();
		
}
function updateData_2013(){
queue()
	.defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2013.csv")
	.await(ready_2013);
	d3.select("h2 span").text("2013")
			.transition()
			//.delay(750);
			.duration(750);
}
function ready_2013(error, CD_topoJSON, DM_2013) {

	var countById = {};
	DM_2013.forEach (function(d) {countById[d.FIPS] = +d.count; });

    g.append("g")
        .attr("class", "collection")
        .selectAll("path")
          .data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
        .enter().append("path")
		
          .attr("d", path)
		  .style("fill", function(d) {return color(countById[d.id]); })

		updateData_2014();
		
}
function updateData_2014(){
queue()
	.defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2014.csv")
	.await(ready_2014);
	d3.select("h2 span").text("2014")
			.transition()
			//.delay(750);
			.duration(750);
}
function ready_2014(error, CD_topoJSON, DM_2014) {

	var countById = {};
	DM_2014.forEach (function(d) {countById[d.FIPS] = +d.count; });

    g.append("g")
        .attr("class", "collection")
        .selectAll("path")
          .data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
        .enter().append("path")
		
          .attr("d", path)
		  .style("fill", function(d) {return color(countById[d.id]); })

		updateData_2015();
		
}
function updateData_2015(){
queue()
	.defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2015.csv")
	.await(ready_2015);
	d3.select("h2 span").text("2015")
			.transition()
			//.delay(750);
			.duration(750);
}
function ready_2015(error, CD_topoJSON, DM_2015) {

	var countById = {};
	DM_2015.forEach (function(d) {countById[d.FIPS] = +d.count; });

    g.append("g")
        .attr("class", "collection")
        .selectAll("path")
          .data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
        .enter().append("path")
		
          .attr("d", path)
		  .style("fill", function(d) {return color(countById[d.id]); })

		updateData_2016();
		
}
function updateData_2016(){
queue()
	.defer(d3.json, "data/CD_topoJSON.json")
	.defer(d3.csv, "data/DM_2016.csv")
	.await(ready_2016);
	d3.select("h2 span").text("2016")
			.transition()
			//.delay(750);
			.duration(750);
}
function ready_2016(error, CD_topoJSON, DM_2016) {

	var countById = {};
	DM_2016.forEach (function(d) {countById[d.FIPS] = +d.count; });

    g.append("g")
        .attr("class", "collection")
        .selectAll("path")
          .data(topojson.feature(CD_topoJSON, CD_topoJSON.objects.collection).features)
        .enter().append("path")
		
          .attr("d", path)
		  .style("fill", function(d) {return color(countById[d.id]); })
		
}*/

d3.select("#slider") 
    .call(
      chroniton()  
        .domain([new Date(startYear, 1, 1), new Date(endYear, 1, 1)])  
        .labelFormat(function(date) {
          return Math.ceil(date.getFullYear());  
        })
        .width(600)  
	.on('change', function(date) { 
	  var newYear = Math.ceil(date.getFullYear());  
	  if (newYear != currentYear) { 
		currentYear = newYear;
		//g.selectAll("path").remove(); 
		g.selectAll("path")
			//.transition().duration(500);
		//ready_2000();
		//updateData();
		currentData();
	  }
	})
	//.playButton(true) 
	//.playbackRate(0.3)
	//.loop(true)
);

var legend = svg.selectAll("g.legend")
	.data(ext_color_domain)
	.enter().append("g")
	.style("font-size", "14px")
	.style("font-family", "Arial, Helvetica, sans-serif")
	.attr("class", "legend");
	
var ls_w = 25, ls_h = 25;

legend.append("rect")
	.attr("x", 50)
	.attr("y", function(d, i){return height - (i*ls_h) - 2*ls_h;})
	<!-- .attr('transform', 'translate(10, -720)') /* XY position of legend*/ -->
	.attr('transform', 'translate(25, -380)') /* XY position of legend*/
	.attr("width", ls_w)
	.attr("height", ls_h)
	.style("fill", function(d, i){return color(d);})
	.style("opacity", 0.8);
legend.append("text")
	.attr("x", 80)
	.attr("y", function(d, i){return height - (i*ls_h) - ls_h - 5;})
	<!-- .attr('transform', 'translate(10, -720)') /* XY position of legend*/ -->
	.attr('transform', 'translate(25, -380)') /* XY position of legend*/
	.text(function(d, i){return legend_labels[i];});

function typeAndSet(d) {
    d.count = +d.count;
    countById.set(d.FIPS, d);   
}

function updateClasses() {
	svg.selectAll(".collection path")
		.attr("fill", function(d) {return color(countById.get(d.id)[CURR_SELECT[0]]); });
}

d3.select(self.frameElement).style("height", height + "px");

</script>
